<!doctype html>
<html lang="fr">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/css/bootstrap.min.css" integrity="sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu" crossorigin="anonymous">
    <style>
      form div.starter { border-bottom: grey 1px solid; padding-bottom: 1px; }
      form div.dish { padding-top: 2px; padding-bottom: 1px; }
      form div.dessert { border-top: grey 1px solid; padding-top: 2px; }
      form div.error-message { display: none; }
      form div.has-error div.error-message { display: inline; color: #ed4337; font-style: oblique }
      input { padding-left: 0.2em; padding-right: 0.2em; }
      form fieldset input { width: 5em; margin-left: 1em; }
      form input:invalid { border-color: #ed4337 }
    </style>
    <script>
      document.addEventListener('DOMContentLoaded', function () {
          const errorClass = 'has-error';
          let form = document.querySelector('#reservation');

          let validations = [
              {'reference_fields': ['insidemaindish', 'insideextradish', 'insidethirddish'],
               'validations': [{'section': 'inside-menu-starter', 'validated_fields': ['insidemainstarter', 'insideextrastarter']},
                               {'section': 'inside-menu-dessert', 'validated_fields': ['insidemaindessert', 'insideextradessert']}]},
              {'reference_fields': ['kidsmaindish', 'kidsextradish', 'kidsthirddish'],
               'validations': [{'section': 'kids-menu-dessert', 'validated_fields': ['kidsmaindessert', 'kidsextradessert']}]}
          ];

          function sumOfInputFields(inputFieldIds) {
              return inputFieldIds.reduce((sum, fieldId) => sum + parseInt(document.getElementById(fieldId).value),
                                          0);
          }

          function runValidation(validation_suite) {
              let referenceSum = sumOfInputFields(validation_suite.reference_fields);
              validation_suite.validations.forEach(function(validation) {
                  var section = document.getElementById(validation.section);
                  var inputSum = sumOfInputFields(validation.validated_fields);

                  if (inputSum == referenceSum) {
                      section.classList.remove(errorClass);
                  } else {
                      section.classList.add(errorClass);
                  }
              });
          }

          function validateAll() {
              validations.forEach(runValidation);
          }

          form.addEventListener('submit', function (event) {
              // Reset error classes
              resetErrorClasses();

              validateAll();

              // Prevent form submission if there are errors
              if (form.querySelectorAll('.' + errorClass).length > 0) {
                  event.preventDefault();
              }
          });

          function updatePrice() {
              const prices = {
                  'insidemaindish': 2900,
                  'insideextradish': 3400,
                  'insidethirddish': 3400,
                  'kidsmaindish': 1900,
                  'kidsextradish': 2400,
                  'kidsthirddish': 2400,
                  'outsidemainstarter': 900,
                  'outsideextrastarter': 900,
                  'outsidemaindish': 1700,
                  'outsideextradish': 2200,
                  'outsidethirddish': 2200,
                  'outsidemaindessert': 600,
                  'outsideextradessert': 600
              };
              let totalPrice = 0;
              for (let key in prices) {
                  totalPrice += parseInt(document.getElementById(key).value) * prices[key];
              }
              let cents = String(totalPrice % 100).padStart(2, '0');
              document.getElementById('reservation-submit').value = totalPrice == 0?'Confirmer':`Prix total: ${totalPrice / 100}.${cents}€. Confirmer`
          }

          form.addEventListener('change', function (event) {
              validateAll();
              updatePrice();
          });

          function resetErrorClasses() {
              var errorSections = form.querySelectorAll('.' + errorClass);
              errorSections.forEach(function (section) {
                  section.classList.remove(errorClass);
              });
          }

          resetErrorClasses();
          validateAll();
          updatePrice();
      });
    </script>
  </head>
  <body>
    <form method="POST" class="container" id="reservation" action="post_reservation.cgi">
      <div class="row">
        <label for="name-field-id" class="col-xs-2">Nom</label>
        <input id="name-field-id" class="col-xs-10" type="text" name="name" required="required" minlength="2">
      </div>
      <div class="row">
        <label for="email-field-id" class="col-xs-2">E-mail</label>
        <input id="email-field-id" class="col-xs-10" type="email" name="email" required="required">
      </div>
      <div class="row">
        <label for="extraComment-field-id" class="col-xs-12">Commentaire (p.ex. pour le placement si vous venez avec un autre groupe)</label>
      </div>
      <div class="row">
        <input id="extraComment-field-id" class="col-xs-12" type="text" name="extraComment">
      </div>
      <div class="row">
        <label for="places-field-id" class="col-xs-3">Nombre de places</label>
        <input id="places-field-id" class="col-xs-3" name="places" type="number" min="1" max="50" value="1">
        <label for="date-field-id" class="col-xs-2">Date</label>
        <input id="date-field-id" class="col-xs-4" name="date" type="date" readonly="readonly" value="2099-01-01">
      </div>
      <div class="row">
        <fieldset class="col-md-4">
          <legend>Menu Complet</legend>
          <div class="starter sum-group" id="inside-menu-starter">
            <div class="error-message">Le nombre total d'entrées doit correspondre au nombre total de plats</div>
            <div style="display: grid;">
              <div style="display: flex; place-items: center; grid-row: 1; grid-column: 1">
                <label for="insidemainstarter">Carpaccio de boeuf</label>
              </div>
              <div style="display: flex; place-items: center; grid-row: 1; grid-column: 2;">
                <input min="0" max="50" size="5" type="number" id="insidemainstarter" name="insidemainstarter" value="0">
              </div>
              <div style="display: flex; place-items: center; grid-row: 2; grid-column: 1">
                <label for="insideextrastarter">Croquettes au fromage avec sa garniture</label>
              </div>
              <div style="display: flex; place-items: center; grid-row: 2; grid-column: 2;">
                <input min="0" max="50" size="5" type="number" id="insideextrastarter" name="insideextrastarter" value="0">
              </div>
            </div>
          </div>
          <div class="dish sum-group" id="inside-menu-dish">
            <div style="display: grid;">
              <div style="display: flex; place-items: center; grid-row: 1; grid-column: 1">
                <label for="insidemaindish">Spaghetti bolognaise</label>
              </div>
              <div style="display: flex; place-items: center; grid-row: 1; grid-column: 2;">
                <input min="0" max="50" size="5" type="number" id="insidemaindish" name="insidemaindish" value="0">
              </div>
              <div style="display: flex; place-items: center; grid-row: 2; grid-column: 1">
                <label for="insideextradish">Spaghetti aux scampis</label>
              </div>
              <div style="display: flex; place-items: center; grid-row: 2; grid-column: 2;">
                <input min="0" max="50" size="5" type="number" id="insideextradish" name="insideextradish" value="0">
              </div>
              <div style="display: flex; place-items: center; grid-row: 3; grid-column: 1">
                <label for="insidethirddish">Spaghetti végétarien</label>
              </div>
              <div style="display: flex; place-items: center; grid-row: 3; grid-column: 2;">
                <input min="0" max="50" size="5" type="number" id="insidethirddish" name="insidethirddish" value="0">
              </div>
            </div>
          </div>
          <div class="dessert sum-group" id="inside-menu-dessert">
            <div class="error-message">Le nombre total de desserts doit correspondre au nombre total de plats</div>
            <div style="display: grid;">
              <div style="display: flex; place-items: center; grid-row: 1; grid-column: 1">
                <label for="insidemaindessert">Moelleux au chocolat avec sauce vanille</label>
              </div>
              <div style="display: flex; place-items: center; grid-row: 1; grid-column: 2;">
                <input min="0" max="50" size="5" type="number" id="insidemaindessert" name="insidemaindessert" value="0">
              </div>
              <div style="display: flex; place-items: center; grid-row: 2; grid-column: 1">
                <label for="insideextradessert">Glace Caramel beurre salé du P'tit Seigneur - Produit local</label>
              </div>
              <div style="display: flex; place-items: center; grid-row: 2; grid-column: 2;">
                <input min="0" max="50" size="5" type="number" id="insideextradessert" name="insideextradessert" value="0">
              </div>
            </div>
          </div>
        </fieldset>
        <fieldset class="col-md-4">
          <legend>Menu Enfant (&lt; 12 ans)</legend>
          <div class="dish sum-group" id="kids-menu-dish">
            <div style="display: grid;">
              <div style="display: flex; place-items: center; grid-row: 1; grid-column: 1">
                <label for="kidsmaindish">Spag. bolognaise (enfants)</label>
              </div>
              <div style="display: flex; place-items: center; grid-row: 1; grid-column: 2;">
                <input min="0" max="50" size="5" type="number" id="kidsmaindish" name="kidsmaindish" value="0">
              </div>
              <div style="display: flex; place-items: center; grid-row: 2; grid-column: 1">
                <label for="kidsextradish">Spag. aux scampis (enfants)</label>
              </div>
              <div style="display: flex; place-items: center; grid-row: 2; grid-column: 2;">
                <input min="0" max="50" size="5" type="number" id="kidsextradish" name="kidsextradish" value="0">
              </div>
              <div style="display: flex; place-items: center; grid-row: 3; grid-column: 1">
                <label for="kidsthirddish">Spag. aux légumes (enfants)</label>
              </div>
              <div style="display: flex; place-items: center; grid-row: 3; grid-column: 2;">
                <input min="0" max="50" size="5" type="number" id="kidsthirddish" name="kidsthirddish" value="0">
              </div>
            </div>
          </div>
          <div class="dessert sum-group" id="kids-menu-dessert">
            <div class="error-message">Le nombre total de desserts doit correspondre au nombre total de plats enfants</div>
            <div style="display: grid;">
              <div style="display: flex; place-items: center; grid-row: 1; grid-column: 1">
                <label for="kidsmaindessert">Moelleux au chocolat avec sauce vanille</label>
              </div>
              <div style="display: flex; place-items: center; grid-row: 1; grid-column: 2;">
                <input min="0" max="50" size="5" type="number" id="kidsmaindessert" name="kidsmaindessert" value="0">
              </div>
              <div style="display: flex; place-items: center; grid-row: 2; grid-column: 1">
                <label for="kidsextradessert">Glace Caramel beurre salé du P'tit Seigneur - Produit local</label>
              </div>
              <div style="display: flex; place-items: center; grid-row: 2; grid-column: 2;">
                <input min="0" max="50" size="5" type="number" id="kidsextradessert" name="kidsextradessert" value="0">
              </div>
            </div>
          </div>
        </fieldset>
        <fieldset class="col-md-4">
          <legend>À la carte</legend>
          <div class="starter sum-group" id="outside-menu-starter">
            <div style="display: grid;">
              <div style="display: flex; place-items: center; grid-row: 1; grid-column: 1">
                <label for="outsidemainstarter">Carpaccio de boeuf</label>
              </div>
              <div style="display: flex; place-items: center; grid-row: 1; grid-column: 2;">
                <input min="0" max="50" size="5" type="number" id="outsidemainstarter" name="outsidemainstarter" value="0">
              </div>
              <div style="display: flex; place-items: center; grid-row: 2; grid-column: 1">
                <label for="outsideextrastarter">Croquettes au fromage avec sa garniture</label>
              </div>
              <div style="display: flex; place-items: center; grid-row: 2; grid-column: 2;">
                <input min="0" max="50" size="5" type="number" id="outsideextrastarter" name="outsideextrastarter" value="0">
              </div>
            </div>
          </div>
          <div class="dish sum-group" id="outside-menu-dish">
            <div style="display: grid;">
              <div style="display: flex; place-items: center; grid-row: 1; grid-column: 1">
                <label for="outsidemaindish">Spaghetti bolognaise</label>
              </div>
              <div style="display: flex; place-items: center; grid-row: 1; grid-column: 2;">
                <input min="0" max="50" size="5" type="number" id="outsidemaindish" name="outsidemaindish" value="0">
              </div>
              <div style="display: flex; place-items: center; grid-row: 2; grid-column: 1">
                <label for="outsideextradish">Spaghetti aux scampis</label>
              </div>
              <div style="display: flex; place-items: center; grid-row: 2; grid-column: 2;">
                <input min="0" max="50" size="5" type="number" id="outsideextradish" name="outsideextradish" value="0">
              </div>
              <div style="display: flex; place-items: center; grid-row: 3; grid-column: 1">
                <label for="outsidethirddish">Spaghetti végétarien</label>
              </div>
              <div style="display: flex; place-items: center; grid-row: 3; grid-column: 2;">
                <input min="0" max="50" size="5" type="number" id="outsidethirddish" name="outsidethirddish" value="0">
              </div>
            </div>
          </div>
          <div class="dessert sum-group" id="outside-menu-dessert">
            <div style="display: grid;">
              <div style="display: flex; place-items: center; grid-row: 1; grid-column: 1">
                <label for="outsidemaindessert">Moelleux au chocolat avec sauce vanille</label>
              </div>
              <div style="display: flex; place-items: center; grid-row: 1; grid-column: 2;">
                <input min="0" max="50" size="5" type="number" id="outsidemaindessert" name="outsidemaindessert" value="0">
              </div>
              <div style="display: flex; place-items: center; grid-row: 2; grid-column: 1">
                <label for="outsideextradessert">Glace Caramel beurre salé du P'tit Seigneur - Produit local</label>
              </div>
              <div style="display: flex; place-items: center; grid-row: 2; grid-column: 2;">
                <input min="0" max="50" size="5" type="number" id="outsideextradessert" name="outsideextradessert" value="0">
              </div>
            </div>
          </div>
        </fieldset>
      </div>
      <div class="row">
        <p class="col-md-12">La Société Royale d'Harmonie de Braine-l'Alleud respecte votre vie privée. Les données de contact que vous nous communiquez dans ce formulaire seront uniquement utilisées dans le cadre de ce souper italien, à moins que vous nous donniez l'autorisation de les garder pour vous informer de nos concerts et autres fêtes dans le futur. Contactez <a href="mailto:nobody@example.com">nobody@example.com</a> pour demander d'être retiré de nos fichiers.</p>
      </div>
      <div class="row">
        <input type="checkbox" value="" id="gdpr_accepts_use" name="gdpr_accepts_use" class="col-xs-1">
        <label for="gdpr_accepts_use" class="col-xs-11">Je désire être tenu au courant des activités futures de la SRH de Braine-l'Alleud et l'autorise à conserver mon nom et mon adresse email à cette fin.</label>
      </div>
      <input type="submit" id="reservation-submit" value="Confirmer" style="width: 100%;">
    </form>
  </body>
</html>
