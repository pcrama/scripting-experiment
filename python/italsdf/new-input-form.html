<!doctype html>
<html lang="fr">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/css/bootstrap.min.css" integrity="sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu" crossorigin="anonymous">
    <style>
      div.starter { border-bottom: grey 1px solid; padding-bottom: 1px; }
      div.dish { padding-top: 2px; padding-bottom: 1px; }
      div.dessert { border-top: grey 1px solid; padding-top: 2px; }
      div.error-message { display: none; }
      div.has-error div.error-message { display: inline; color: darkred; font-style: oblique }
      input { width: 5em; margin-left: 1em; }
    </style>
    <script>
      document.addEventListener('DOMContentLoaded', function () {
          const errorClass = 'has-error';
          let form = document.querySelector('#reservation');

          let validations = [
              {'reference_fields': ['insidemaindish', 'insideextradish', 'insidethirddish'],
               'validations': [{'section': 'complete-menu-starter', 'validated_fields': ['insidemainstarter', 'insideextrastarter']},
                               {'section': 'complete-menu-dessert', 'validated_fields': ['insidemaindessert', 'insideextradessert']}]},
              {'reference_fields': ['kidsmaindish', 'kidsextradish', 'kidsthirddish'],
               'validations': [{'section': 'kids-menu-dessert', 'validated_fields': ['kidsmaindessert', 'kidsextradessert']}]}
          ];

          function sumOfInputFields(inputFieldIds) {
              return inputFieldIds.reduce((sum, fieldId) => sum + parseInt(document.getElementById(fieldId).value),
                                          0);
          }

          function runValidation(validation_suite) {
              let referenceSum = sumOfInputFields(validation_suite.reference_fields);
              validation_suite.validations.forEach(function(validation) {
                  var section = document.getElementById(validation.section);
                  var inputSum = sumOfInputFields(validation.validated_fields);

                  if (inputSum == referenceSum) {
                      section.classList.remove(errorClass);
                  } else {
                      section.classList.add(errorClass);
                  }
              });
          }

          function validateAll() {
              validations.forEach(runValidation);
          }

          form.addEventListener('submit', function (event) {
              // Reset error classes
              resetErrorClasses();

              validateAll();

              // Prevent form submission if there are errors
              if (form.querySelectorAll('.' + errorClass).length > 0) {
                  event.preventDefault();
              }
          });

          form.addEventListener('change', function (event) {
              validateAll();
          });

          function resetErrorClasses() {
              var errorSections = form.querySelectorAll('.' + errorClass);
              errorSections.forEach(function (section) {
                  section.classList.remove(errorClass);
              });
          }
      });
    </script>
  </head>
  <body>
    <form method="POST" class="container" id="reservation">
      <fieldset class="col-md-4">
        <legend>Menu Complet</legend>
        <div class="starter sum-group" id="complete-menu-starter">
          <div class="error-message">Le nombre total d'entrées doit correspondre au nombre total de plats</div>
          <div><label for="insidemainstarter">Carpaccio</label>
          <input min="0" max="50" size="5" type="number" id="insidemainstarter" name="insidemainstarter" value="0"></div>
          <div><label for="insideextrastarter">Fondus au fromage</label>
          <input min="0" max="50" size="5" type="number" id="insideextrastarter" name="insideextrastarter" value="0"></div>
        </div>
        <div class="dish sum-group">
          <div><label for="insidemaindish">Spaghetti Bolognaise</label>
          <input min="0" max="50" size="5" type="number" id="insidemaindish" name="insidemaindish" value="0"></div>
          <div><label for="insideextradish">Spaghetti avec sauce aux Scampis</label>
          <input min="0" max="50" size="5" type="number" id="insideextradish" name="insideextradish" value="0"></div>
          <div><label for="insidethirddish">Spaghetti végétariens</label>
          <input min="0" max="50" size="5" type="number" id="insidethirddish" name="insidethirddish" value="0"></div>
        </div>
        <div class="dessert sum-group" id="complete-menu-dessert">
          <div class="error-message">Le nombre total de desserts doit correspondre au nombre total de plats.</div>
          <div><label for="insidemaindessert">Fondu au chocolat</label>
          <input min="0" max="50" size="5" type="number" id="insidemaindessert" name="insidemaindessert" value="0"></div>
          <div><label for="insideextradessert">Portion de glace</label>
          <input min="0" max="50" size="5" type="number" id="insideextradessert" name="insideextradessert" value="0"></div>
        </div>
      </fieldset>
      <fieldset class="col-md-4">
        <legend>Menu Enfant</legend>
        <div class="dish sum-group">
          <div><label for="kidsmaindish">Spaghetti Bolognaise</label>
          <input min="0" max="50" size="5" type="number" id="kidsmaindish" name="kidsmaindish" value="0"></div>
          <div><label for="kidsextradish">Spaghetti avec sauce aux Scampis</label>
          <input min="0" max="50" size="5" type="number" id="kidsextradish" name="kidsextradish" value="0"></div>
          <div><label for="kidsthirddish">Spaghetti végétariens</label>
          <input min="0" max="50" size="5" type="number" id="kidsthirddish" name="kidsthirddish" value="0"></div>
        </div>
        <div class="dessert sum-group" id="kids-menu-dessert">
          <div class="error-message">Le nombre total de desserts doit correspondre au nombre total de plats enfants.</div>
          <div><label for="kidsmaindessert">Fondu au chocolat</label>
          <input min="0" max="50" size="5" type="number" id="kidsmaindessert" name="kidsmaindessert" value="0"></div>
          <div><label for="kidsextradessert">Portion de glace</label>
          <input min="0" max="50" size="5" type="number" id="kidsextradessert" name="kidsextradessert" value="0"></div>
        </div>
      </fieldset>
      <fieldset class="col-md-4">
        <legend>À la carte</legend>
        <div class="starter sum-group">
          <div><label for="outsidemainstarter">Carpaccio</label>
          <input min="0" max="50" size="5" type="number" id="outsidemainstarter" name="outsidemainstarter" value="0"></div>
          <div><label for="outsideextrastarter">Fondus au fromage</label>
          <input min="0" max="50" size="5" type="number" id="outsideextrastarter" name="outsideextrastarter" value="0"></div>
        </div>
        <div class="dish sum-group">
          <div><label for="outsidemaindish">Spaghetti Bolognaise</label>
          <input min="0" max="50" size="5" type="number" id="outsidemaindish" name="outsidemaindish" value="0"></div>
          <div><label for="outsideextradish">Spaghetti avec sauce aux Scampis</label>
          <input min="0" max="50" size="5" type="number" id="outsideextradish" name="outsideextradish" value="0"></div>
          <div><label for="outsidethirddish">Spaghetti végétariens</label>
          <input min="0" max="50" size="5" type="number" id="outsidethirddish" name="outsidethirddish" value="0"></div>
        </div>
        <div class="dessert sum-group">
          <div><label for="outsidemaindessert">Fondu au chocolat</label>
          <input min="0" max="50" size="5" type="number" id="outsidemaindessert" name="outsidemaindessert" value="0"></div>
          <div><label for="outsideextradessert">Portion de glace</label>
          <input min="0" max="50" type="number" id="outsideextradessert" name="outsideextradessert" value="0"></div>
        </div>
      </fieldset>
      <input type="submit" value="Confirmer" style="width: 100%;">
    </form>
  </body>
</html>
